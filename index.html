<html>
    <head>
        <meta charset="utf-8">
        <link href="css/bootstrap.min.css" rel="stylesheet">
	<style>
	#box { width: 90px; height: 45px; }
	.lines { border: 2px solid #000; }
	.error { border: 1px solid red !important; }
        div.colorbox {
            border: 1px solid #777777;
            height: 100px;
            width: 100px;
            /*background-color: #ffffff;*/
            transition: background-color 1s linear;
            -moz-transition: background-color 1s linear;
            -o-transition: background-color 1s linear;
            -webkit-transition: background-color 1s linear;
        }
        div.colorbox:hover, div.colored {
            background-color: #ff0000;
        }  
	</style>	
	<script src="src/build.js"></script>
    </head>
    <body>
        <div class="container">
	    <h1>js-helping</h1>            
            <div class="row">
                <div class="span4">
                    <h2>Socket Data</h2>
                    <div id="clock"></div> 
                    <div id="box"></div>
                </div>
                <div class="span4">
                    <h2>Form</h2>
	            <form id="loginFrm" class="form-horizontal" action="/login" method="post">
                    <fieldset>
                        <div class="control-group"><input type="email" class="span3" id="email" value="" placeholder="email@web.de" pattern="^([0-9a-zA-Z]+([_.-]?[0-9a-zA-Z]+)*@[0-9a-zA-Z]+[0-9,a-z,A-Z,.,-]*(.){1}[a-zA-Z]{2,4})+$"></div>
                        <div class="control-group"><input type="password" name="password" class="span3" placeholder="password"></div>
                        <div class="control-group"><button type="submit" class="btn btn-primary">Login</button></div>
                        <div><span id="frmMsg"></span></div>
                    </fieldset>
                    </form> 
                </div>
                <div class="span4">
                    <h2>Mouseover</h2>
                    <div class="colorbox" id="box1"></div>
                    <br> 
                    <div class="colorbox" id="box2"></div>
                </div>
            </div>
	    </div>
	    <script>
            window.onload = function() {
                // wrap namespace in variable
	            var jsc = JSHELPING;
		
                var modArray = jsc._array();			
	  	
	  	        var myArr = [1,2,3];
                console.log( modArray.isArray(myArr) );
		        console.log( modArray.isArray(true) );
		        modArray.each(myArr, function add(x){return x+=10;});		        
		        console.log(myArr);         
				
		        var modElement = jsc._element();
		        modElement.add('box', 'output');
				
		        setTimeout(function() {
		            modElement.addClass(document.querySelector('#box2'), 'collored');
		        }, 2000);
				
		        setTimeout(function() {
                    modElement.removeClass(document.querySelector('#box2'), 'colored');
		        }, 4000);
		
		// handle form
		var modForm = jsc._form();
		var modEvent = jsc._event(); 
		var frm = document.querySelector('#loginFrm'),
		    frmLength = frm.length;
		modEvent.add(frm, 'submit', function(e) {
		    e.preventDefault();			
			var frmResponse = modForm.validate('loginFrm');			
			var error = false;
			for (var i = 0; i <= frmLength; i++) {
			    if (frmResponse[i]) {
			        var ele = document.querySelector('#' + frmResponse[i].element);
			        if (frmResponse[i].error) {
			            modElement.addClass(ele, 'error');
			            error = true;
			        } else {
			            modElement.removeClass(ele, 'error');
			        }			        
			    }
			}
			document.querySelector('#frmMsg').innerHTML = JSON.stringify(frmResponse);
			if (error) {
			    console.log('form error');
			} else {
			    console.log('send form');
			}
			return false;
		});
			 
		
		var modObject = jsc._object();
		
                function A() {
                    this.name = 'A';
                }
                A.prototype.sayA = function sayA() {
                    return 'sayA ' + this.name;
                }

                function B() {
                    //this.name = 'B'; // overwrite this.name
                }
	
                modObject.extend(B, A);

                B.prototype.sayB = function sayB() {
                    return 'sayB ' + this.name;
                }

                var b = new B();

                console.log( b.name ); // A
                console.log( b.sayA() ); // sayA A
                console.log( b.sayB() ); // sayB A
		
                var c = modObject.clone(B);		
                console.log( b.sayB() ); // A				
		
		var modSocket = jsc._socketio();
                var msgCount = 0; 		
                function myHandler(data) {
                    msgCount += 1;
		    document.querySelector('#output').innerHTML = data.message.content+' '+msgCount;
		}
                
		var handlings = [
		    {'name':'msg', 'func': myHandler},
		    {'name':'update', 'func': function(data){document.querySelector('#clock').innerHTML=data.time;}}
		];
		
                modSocket.connect('http://localhost:3000', handlings);
		
                modSocket.send('echo', {'content':'test1'});
		modSocket.send('echo', {'content':'test2'});
	    }
	</script>
    </body>
</html>
